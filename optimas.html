<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>神石計算機</title>
    <style>
        :root { --primary: #2563eb; --accent: #e11d48; --bg: #f1f5f9; }
        body { font-family: sans-serif; background: var(--bg); padding: 20px; color: #334155; max-width: 800px; margin: 0 auto; line-height: 1.5; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: var(--primary); margin-bottom: 25px; }
        .input-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
        label { display: block; font-size: 0.85rem; font-weight: bold; margin-bottom: 5px; }
        select, input { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; }
        .info { background: #eff6ff; border-left: 4px solid var(--primary); padding: 10px; font-size: 0.85rem; margin-bottom: 20px; }
        .pattern-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .pattern-card { border: 1px solid #e2e8f0; border-radius: 12px; padding: 18px; position: relative; background: #fff; }
        .pattern-tag { position: absolute; top: 12px; right: 12px; font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; background: #e2e8f0; }
        .pattern-title { font-weight: bold; color: var(--primary); margin-bottom: 10px; font-size: 1.1rem; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 4px; border-bottom: 1px inset #f8fafc; }
        .val { font-weight: bold; }
        .shortage { color: var(--accent); }
    </style>
</head>
<body>

<div class="card">
    <h1>神石計算機</h1>

    <div class="info">
        <strong>アニマ取得仕様:</strong> 無凸:1個 / 1凸:2個 / 2凸:3個 / 3~4凸:4個 / 5凸:5個<br>
        ※本計算機では、超越に必要なアニマを確保するための「砕き」パターンを算出します。
    </div>

    <div class="input-group">
        <div>
            <label>現在の段階</label>
            <select id="cur">
                <option value="0">0凸</option><option value="1">1凸</option>
                <option value="2">2凸</option><option value="3">3凸</option>
                <option value="4">4凸</option><option value="5">5凸</option>
                <option value="6">210</option><option value="7">220</option>
                <option value="8">230</option><option value="9">240</option>
            </select>
        </div>
        <div>
            <label>目標の段階</label>
            <select id="tar">
                <option value="3">3凸</option><option value="4">4凸</option>
                <option value="5">5凸</option><option value="10" selected>250(超越)</option>
            </select>
        </div>
        <div>
            <label>所持素体数(0凸)</label>
            <input type="number" id="owned" value="0" min="0">
        </div>
    </div>

    <div id="results" class="pattern-grid"></div>
</div>

<script>
function calculate() {
    const cur = parseInt(document.getElementById('cur').value);
    const tar = parseInt(document.getElementById('tar').value);
    const owned = parseInt(document.getElementById('owned').value) || 0;
    const res = document.getElementById('results');
    res.innerHTML = "";

    if (cur >= tar) { res.innerHTML = "目標達成済みです。"; return; }

    // 必要アニマ数計算
    let animaNeeded = 0;
    if (tar >= 4 && cur < 4) animaNeeded += 1;
    if (tar >= 5 && cur < 5) animaNeeded += 1;
    if (tar >= 6) animaNeeded += (Math.min(tar, 10) - Math.max(cur, 5));

    const stepsTo3 = Math.max(0, Math.min(3, tar) - Math.min(3, cur));

    // パターン定義
    const patterns = [
        { name: "金剛晶温存ルート", desc: "素体を優先的に上限解放に使い、余りを無凸で砕く", prioritize: "step" },
        { name: "アニマ最大効率ルート", desc: "凸は金剛晶で行い、素体をできるだけ高段階で砕く", prioritize: "anima" }
    ];

    patterns.forEach(p => {
        let sunstone = 0;
        let usedForStep = 0;
        let animaGot = 0;

        if (p.prioritize === "step") {
            usedForStep = Math.min(owned, stepsTo3);
            sunstone = stepsTo3 - usedForStep;
            animaGot = (owned - usedForStep) * 1; // 残りを無凸で砕く
        } else {
            sunstone = stepsTo3;
            // 素体を3凸にして砕くシミュレーション (金剛に余裕がある前提)
            // 実際はユーザーの判断だが、ここでは「素体をそのまま砕く」場合を基準に表示
            animaGot = owned * 1;
        }

        const shortage = Math.max(0, animaNeeded - animaGot);

        const div = document.createElement('div');
        div.className = 'pattern-card';
        div.innerHTML = `
            <div class="pattern-title">${p.name}</div>
            <div class="pattern-tag">${p.prioritize === "step" ? "節約" : "効率"}</div>
            <p style="font-size:0.75rem; color:#64748b; margin-top:-5px;">${p.desc}</p>
            <div class="stat-row"><span>上限解放に使用する金剛晶:</span><span class="val">${sunstone} 個</span></div>
            <div class="stat-row"><span>素体からのアニマ取得:</span><span class="val">${animaGot} 個</span></div>
            <div class="stat-row"><span>不足アニマ:</span><span class="val shortage">${shortage} 個</span></div>
            <div style="margin-top:10px; font-size:0.8rem; background:#f8fafc; padding:8px; border-radius:6px;">
                <strong>アドバイス:</strong><br>
                ${shortage > 0 ? `アニマが${shortage}個足りません。素体を1凸にして砕けば、1本あたり2個のアニマが手に入ります。` : "アニマは足ります。余った素体は保管しておきましょう。"}
            </div>
        `;
        res.appendChild(div);
    });
}

document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', calculate));
calculate();
</script>

</body>
</html>
